<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Chat Privado por Placas</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; background-color: #f9f9f9; }
    #chatBox { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; margin-bottom: 15px; background: #fff; }
    textarea, select, button { width: 100%; padding: 10px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Chat Privado UniRide</h1>
  <div id="chatBox"></div>

  <select id="role">
    <option value="Alumno">Alumno</option>
    <option value="Conductor">Conductor</option>
  </select>

  <textarea id="mensaje" placeholder="Escribe tu mensaje..."></textarea>
  <button onclick="enviarMensaje()">Enviar mensaje</button>

  <script>
    const firebaseConfig = { /* TU CONFIGURACIÃ“N FIREBASE */ };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const placas = localStorage.getItem("placas_chat");
    const refSala = db.ref("chat/sala_" + placas);
    const chatBox = document.getElementById("chatBox");

    refSala.on("child_added", snapshot => {
      const msg = snapshot.val();
      const div = document.createElement("div");
      div.textContent = `${msg.usuario}: ${msg.mensaje}`;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    });

    function enviarMensaje() {
      const usuario = document.getElementById("role").value;
      const mensaje = document.getElementById("mensaje").value.trim();
      if (!mensaje) return;
      refSala.push({ usuario, mensaje });
      document.getElementById("mensaje").value = "";
    }
  </script>
</body>
</html>
